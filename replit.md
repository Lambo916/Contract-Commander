# Overview

Contract Commander is an AI-powered legal contract drafting tool that generates professional, print-ready contracts (NDAs, Service Agreements, Employment Agreements, MOUs, Partnership Agreements) using OpenAI GPT-4o. The application features a gold/dark/white theme (#F5C543, #111111, #FFFFFF, #C9C9D1) and produces clean legal documents with proper structure, formatting, and signature blocks. Users can export contracts as PDF or Word documents. Built with vanilla HTML/CSS/JS with database-backed report management.

# User Preferences

Preferred communication style: Simple, everyday language.

# Recent Changes (November 2025)

## Production Polish v1.0 - App Footer & PDF Export Refinements
- **App Footer Redesign**: Implemented clean 2-line footer structure across all screens
  - Line 1: "Powered by YourBizGuru.com • Privacy Policy • Terms of Service" (12.5px, links with hover underline)
  - Line 2: Full legal disclaimer in plain language (11.5px, 60% gray, centered, max-width 800px)
  - Mobile responsive with center alignment
  - Footer links open in new tab with proper rel="noopener" attribute
- **PDF Export System Overhaul**: Professional document output with minimal branding
  - Header (every page): Contract type (left, 10pt) + "Generated by Contract Commander" (right, 10pt)
  - Footer pages 1..N-1: "Page X of Y" (left) + "YourBizGuru.com" (right)
  - Footer last page only: Divider line + copyright (auto-year) + full legal notice (multi-line, 9pt)
  - Removed all mid-page banners, duplicate disclaimers, and repeating legal text
  - Removed watermark for clean professional appearance
- **PDF Metadata Updates**: Professional document properties
  - Title: "{ContractType} — {Title} — {YYYY-MM-DD}"
  - Author: "YourBizGuru LLC"
  - Subject: "Generated by Contract Commander"
  - Keywords: "Contract Commander, YourBizGuru, AI Document Generator, Legal Contract"
- **Filename Pattern**: Standardized naming convention
  - Format: "{YYYY}-{MM}-{DD}_ContractCommander_{ContractType}_{Counterparty}.pdf"
  - Example: "2025-11-08_ContractCommander_Service_Agreement_Acme_Corp.pdf"
- **Typography & Spacing**: Consistent document structure
  - Body: 11pt with proper line-height (1.35-1.45)
  - Section spacing: 10-12pt for readability
  - Signature blocks: 24px gap before footer on last page
  - Page margins: 1 inch standard legal document margins

## Form UI Reorganization & Consistent Field Heights
- **Unified CSS Styling**: Created `.ybg-grid input/select/textarea` CSS selectors for consistent form field heights
  - All inputs and selects: 48px min-height with 12px 14px padding
  - All textareas: 120px min-height with proper line-height
  - Consistent borders (1.5px solid), border-radius (8px), and focus states with gold outline
  - Custom select dropdown arrow matching design system
  - Date input: Fixed to fill container width (100%) with browser appearance removed for consistency
- **Logical Form Sections**: Reorganized form into chronological workflow order
  - Contract Setup: Contract Type, Title, Effective Date, Tone, Detail Level (moved Tone/Detail from old Output section)
  - Parties: Ultra-compact inline header with small number dropdown (70px) positioned directly next to "Parties" label; 2-column name/role pairing (Your Organization Name | Your Role, Counterparty Name | Counterparty Role)
  - Contract Terms: Scope, Compensation, Term/Duration, Termination (renamed from "Key Terms")
  - Legal Options: Governing Law, IP Ownership, Confidentiality checkbox (moved from Contract Terms), Additional Clauses
  - Signatures: Signatory 1 & 2 Name/Title (renamed from "Output & Signature")
- **Section Naming**: Clearer section labels that match user intent (e.g., "Contract Terms" instead of "Key Terms", "Signatures" instead of "Output & Signature")
- **CSS Specificity**: Higher specificity selectors (`.ybg-grid input`) override base `ybg.css` styles without breaking existing functionality

## UI Cleanup & Word Export Fix
- **Tooltip Removal**: Removed all tooltip "i" icons from form field labels (redundant with placeholder text)
- **Word Export**: Fixed Word export by correcting CDN URL from `html-docx.min.js` to `html-docx.js`
- **Sandbox Workaround**: Implemented modal-based download for Word export to work around Replit iframe sandbox restrictions
  - Shows visible download button with clear instructions
  - Tries multiple download methods (new window + direct download)
  - XSS-safe DOM construction using createElement/textContent
- **Export Verification**: Added console logging to verify both PDF and Word export modules load successfully
- **Multi-party Support**: Maintained 2-6 party contract support with dynamic form fields
- **Keyboard Shortcuts**: Ctrl+Enter to generate, Ctrl+S to save, Ctrl+N for new contract

## Deployment Fix - Replit Publishing Support
- **CORS Configuration**: Fixed HTTP 500 error when app is deployed via Replit Publishing
  - Added `/\.replit\.app$/` regex pattern to production allowedOrigins in `server/production.ts`
  - Added `https://contract.yourbizguru.com` custom domain to production allowedOrigins
  - Deployment logs showed CORS middleware blocking requests from .replit.app domains and custom domain
  - Production CORS now allows: grant.yourbizguru.com, bizplan.yourbizguru.com, contract.yourbizguru.com, *.vercel.app, and *.replit.app
  - OpenAI API key properly detected in production environment

## Word Export Production Fix
- **Browser Security Compliance**: Fixed Word export failing on live production site (contract.yourbizguru.com)
  - Problem: Browsers block automated downloads (window.open, hidden link auto-click, setTimeout triggers) as security violations
  - Solution: Removed ALL automated download attempts from `handleExportWord()` and `showWordExportModal()`
  - Removed: `window.open(url, '_blank')` call (blocked by pop-up blockers)
  - Removed: Hidden link creation and auto-click via setTimeout (blocked by browser security)
  - Removed: 500ms auto-click on download button in modal
  - Result: User sees modal, clicks visible gold download button themselves (direct user action = allowed by browsers)
  - Modal still displays correctly with blob URL download link
  - .docx file downloads to Downloads folder on user click

## Complete Contract Commander Rebrand
- **Removed BizPlan Builder Remnants**: Cleaned up all leftover template files and updated branding
  - Deleted: `BizPlan-Builder/` folder (old template)
  - Deleted: Unused `public/bizplan.html`, `public/bizplan.js`, `public/bizplan-app.html`
  - Renamed: `bizplan-app.js` → `contract-app.js` (main application logic)
  - Renamed: `bizplan-styles.css` → `contract-styles.css` (application styles)
  - Updated: `public/index.html` to reference `contract-app.js` and `contract-styles.css`
  - Updated: All backend comments in `server/routes.ts` from "BizPlan Builder" to "Contract Commander"
  - Updated: Console.log messages from `[BizPlan]` to `[ContractCommander]`
  - Preserved: API endpoints (`/api/bizplan/*`) and database table names for backward compatibility
  - Preserved: LocalStorage key `ybg-bizplan-autosave` for backward compatibility

# Previous Changes (Phase 3 - v1.1.0)

## Core Framework Extraction (November 2025)
- **Centralized Clients**: All Supabase and OpenAI client initialization now lives in `/core/clients/`
  - `core/clients/supabase.ts` - Unified Supabase client with browser/server/auth variants
  - `core/clients/openai.ts` - Singleton OpenAI client with automatic API key handling
- **Shared Utilities**: Created `/core/utils/` for reusable functions
  - `core/utils/errors.ts` - HttpError class and response helpers
- **Configuration Management**: Centralized app config in `/core/config/index.ts`
  - TOOL_NAME, REPORT_CAP, RATE_LIMIT settings
- **PDF Layer**: Created `/core/pdf/export.ts` placeholder for future server-side PDF generation
- **Type Definitions**: Consolidated contract types in `/models/contracts.ts`
  - ContractInput, GeneratedContract, Party, Clause types
- **Backward Compatibility**: Legacy imports in `lib/supabase.ts` re-export from core
- **Build Status**: ✅ All builds pass, no LSP errors, runtime verified

# System Architecture

## Frontend Architecture
- **Technology Stack**: Pure vanilla HTML, CSS, and JavaScript with no frameworks for maximum compatibility and minimal dependencies
- **Component Structure**: Single-page application with modular CSS variables for Contract Commander branding (gold #F5C543, dark #111111, white #FFFFFF)
- **UI Framework**: Uses shadcn/ui components with React for the client-side application, alongside Tailwind CSS for styling
- **Design System**: Two-panel layout (40% input form, 60% contract preview on desktop, stacked on mobile) with gold/dark/white color scheme
- **Typography**: Montserrat for headings, Open Sans for body text with defined font weights and sizing hierarchy

## Backend Architecture
- **Development Environment**: Express.js server for local Replit development with static file serving
- **Production Deployment**: Vercel serverless functions for production scaling and cost efficiency
- **API Design**: RESTful endpoints with proper CORS headers for iframe embedding compatibility
- **Error Handling**: Comprehensive input validation and structured error responses with appropriate HTTP status codes

## Database and Storage
- **Database**: Supabase PostgreSQL for production-grade data storage with automatic backups and scaling
- **ORM**: Drizzle ORM with PostgreSQL dialect for type-safe database operations
- **Schema Management**: Database migrations handled through drizzle-kit with proper connection configuration
- **Report Persistence**: PostgreSQL compliance_reports table stores saved reports with name, entity details, jurisdiction, filing type, deadline, HTML content, checksum, metadata (JSON), and creation timestamp
- **BizPlan Reports**: PostgreSQL bizplan_reports table stores business plan reports with user ID, title, company, industry, HTML content, metadata, and timestamps
- **API Endpoints**: RESTful CRUD operations (/api/reports/save, /api/reports/list, /api/reports/:id) for report management
- **Local Storage**: Browser localStorage for caching current working report
- **Session Management**: PostgreSQL sessions with connect-pg-simple for user authentication (future feature)
- **Health Monitoring**: /api/health/db endpoint provides Supabase connection status and diagnostics
- **Environment Variables**: Smart pickEnv helper in lib/supabase.ts automatically detects and uses VITE_*, NEXT_PUBLIC_*, or standard SUPABASE_* variables for maximum compatibility across Vite, Next.js, and Express stacks

## Authentication and Authorization
- **User Management**: Supabase authentication with JWT tokens for secure user management (future feature)
- **Session Handling**: Server-side session storage using PostgreSQL with proper security configurations (future feature)
- **API Security**: Environment variable protection for sensitive keys (OpenAI API, database URLs)
- **Supabase Integration**: lib/supabase.ts provides universal browser and server clients with flexible pickEnv helper that works across Vite (VITE_*), Next.js (NEXT_PUBLIC_*), and Express (SUPABASE_*) environments
- **Deployment Ready**: No duplicate environment variables required - SUPABASE_URL/SUPABASE_ANON_KEY work for both server and browser contexts via smart fallback system

## AI Integration
- **Provider**: OpenAI GPT-4o integration for content generation
- **Super Smart AI Mode**: Enhanced AI system that dynamically handles ALL 50 states with state-specific forms, fees, deadlines, penalties, and official URLs
- **Hybrid Architecture**: Tries pre-built filing profiles first (e.g., California Annual Report), falls back to super smart AI for all other jurisdictions
- **API Management**: Centralized OpenAI client initialization with proper error handling and rate limiting
- **Content Processing**: Structured 6-section JSON output (summary, checklist, timeline, riskMatrix, recommendations, references) with Panel=PDF WYSIWYG parity

# External Dependencies

## Third-Party Services
- **OpenAI API**: GPT-4o model for AI-powered content generation with configurable API key management
- **Vercel Platform**: Production deployment and serverless function hosting with custom routing configuration
- **Supabase**: PostgreSQL database service with authentication, real-time capabilities, and automatic backups

## Development Tools
- **Package Management**: npm with lockfile for consistent dependency versions
- **Build Tools**: Vite for development server and build process with React plugin support
- **TypeScript**: Full TypeScript support with proper path aliases and type definitions
- **CSS Framework**: Tailwind CSS with custom design tokens and responsive utilities

## UI Components
- **Radix UI**: Comprehensive set of accessible, unstyled UI primitives for complex interactions
- **Lucide React**: Icon library providing consistent iconography across the application
- **React Hook Form**: Form validation and management with Zod schema validation
- **TanStack Query**: Server state management for API calls and caching strategies

## Deployment Infrastructure
- **DNS**: GoDaddy DNS management for custom domain routing
- **CDN**: Vercel's edge network for global content delivery and performance optimization
- **Static Assets**: Public folder structure for favicons, logos, and brand assets
- **Environment Management**: Separate development and production configurations with environment variable support